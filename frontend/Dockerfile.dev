# Development Dockerfile with hot-reload support
FROM node:20-alpine

# Set working directory
WORKDIR /app

# Disable Next.js telemetry
ENV PORT=5000 \
    NODE_ENV=development \
    NEXT_PUBLIC_SITE_URL=http://localhost:3000 \
    NEXT_PUBLIC_API_URL=http://localhost:5000/api \
    FRONTEND_URL=http://localhost:3000 \
    CORS_ORIGIN=http://localhost:3000 \
    RATE_LIMIT_WINDOW_MS=900000 \
    RATE_LIMIT_MAX_REQUESTS=100 \
    BCRYPT_ROUNDS=12 \
    NEXT_TELEMETRY_DISABLED=1

# Install dependencies first (including devDependencies)
COPY package*.json ./
RUN npm install --legacy-peer-deps

# Copy the rest of the source code
COPY . .

# Expose both Next.js and API ports
EXPOSE 3000
EXPOSE 5000

# Start Next.js in development mode with hot-reload
CMD ["npm", "run", "dev"]